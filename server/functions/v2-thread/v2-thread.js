let GoogleGenerativeAI=require("@google/generative-ai")["GoogleGenerativeAI"],admin=require("firebase-admin"),serviceAccount=require("../xthreadspro-firebase-adminsdk-ty40a-3df7f647f5.json"),db=(admin.apps.length||admin.initializeApp({credential:admin.credential.cert(serviceAccount)}),admin.firestore());async function logTopic(e){try{await db.collection("topics").doc(e).set({topic:e,timestamp:admin.firestore.FieldValue.serverTimestamp()})}catch(e){throw e}}async function generateThread(e,t,r,a){"default"==r?i="":"low"==r?i="Keep it simple. ":"high"==r&&(i="Make it creative. ");var i,r=await new GoogleGenerativeAI(process.env.GEMINI_API_KEY).getGenerativeModel({model:"gemini-1.5-flash"}).generateContent("educative"==a?`Generate a twitter thread for the topic "${e}". This is for educational purpose. Include facts and other interesting things to read. Keep it straightforward and don't use any emojis. It should sound like a ${a} article. ${i}The thread should have ${t} tweets including catchy starting tweet. Give result in a JSON format`:`Generate a twitter thread for the topic "${e}". Include facts and other interesting things to read. Keep it straightforward and don't use any emojis. It should sound like a ${a} article. ${i}The thread should have ${t} tweets including catchy starting tweet. Give result in a JSON format`);return(await r.response).text()}exports.handler=async e=>{if("OPTIONS"==e.httpMethod)return{statusCode:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS, GET","Access-Control-Allow-Headers":"Content-Type"},body:JSON.stringify({message:"success"})};e=JSON.parse(e.body);try{await logTopic(e.topic);var t=await generateThread(e.topic,e.num,e.creativity,e.type),r=JSON.parse(t.substring(8,t.length-4));return{statusCode:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type"},body:JSON.stringify(r)}}catch(e){return console.log(e),{statusCode:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type"},body:JSON.stringify({error:"Internal server error"})}}};