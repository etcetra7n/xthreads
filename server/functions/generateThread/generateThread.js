let GoogleGenerativeAI=require("@google/generative-ai")["GoogleGenerativeAI"],admin=require("firebase-admin"),serviceAccount=require("../xthreadspro-firebase-adminsdk-ty40a-3df7f647f5.json"),db=(admin.apps.length||admin.initializeApp({credential:admin.credential.cert(serviceAccount)}),admin.firestore());async function logTopic(e){try{await db.collection("topics").doc(e).set({topic:e,timestamp:admin.firestore.FieldValue.serverTimestamp()})}catch(e){throw e}}async function generateThread(e){return(await(await new GoogleGenerativeAI(process.env.GEMINI_API_KEY).getGenerativeModel({model:"gemini-1.5-flash"}).generateContent(`Generate a twitter thread for the topic "${e}". This is for educational purpose. Include facts and other interesting things to read. Keep it straightforward and don't use any emojis. It should sound like a informative article. The thread should have 5 tweets including catchy starting tweet. Give result in a JSON format`)).response).text()}exports.handler=async e=>{try{var t=e.queryStringParameters,r=(await logTopic(t.topic),await generateThread(t.topic)),a=JSON.parse(r.substring(8,r.length-4));return{statusCode:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type"},body:JSON.stringify(a)}}catch(e){return console.log(e),{statusCode:500,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type"},body:JSON.stringify({error:"Internal server error"})}}};